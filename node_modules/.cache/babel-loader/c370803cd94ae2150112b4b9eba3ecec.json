{"ast":null,"code":"import { getBlobFromURL } from './getBlobFromURL';\nimport { embedResources } from './embedResources';\nimport { getMimeType, isDataUrl, makeDataUrl, toArray } from './util';\n\nasync function embedBackground(clonedNode, options) {\n  var _a;\n\n  const background = (_a = clonedNode.style) === null || _a === void 0 ? void 0 : _a.getPropertyValue('background');\n\n  if (!background) {\n    return Promise.resolve(clonedNode);\n  }\n\n  return Promise.resolve(background).then(cssString => embedResources(cssString, null, options)).then(cssString => {\n    clonedNode.style.setProperty('background', cssString, clonedNode.style.getPropertyPriority('background'));\n    return clonedNode;\n  });\n}\n\nasync function embedImageNode(clonedNode, options) {\n  if (!(clonedNode instanceof HTMLImageElement && !isDataUrl(clonedNode.src)) && !(clonedNode instanceof SVGImageElement && !isDataUrl(clonedNode.href.baseVal))) {\n    return Promise.resolve(clonedNode);\n  }\n\n  const src = clonedNode instanceof HTMLImageElement ? clonedNode.src : clonedNode.href.baseVal;\n  return Promise.resolve(src).then(url => getBlobFromURL(url, options)).then(data => makeDataUrl(data.blob, getMimeType(src) || data.contentType)).then(dataURL => new Promise((resolve, reject) => {\n    clonedNode.onload = resolve;\n    clonedNode.onerror = reject;\n\n    if (clonedNode instanceof HTMLImageElement) {\n      clonedNode.srcset = '';\n      clonedNode.src = dataURL;\n    } else {\n      clonedNode.href.baseVal = dataURL;\n    }\n  })).then(() => clonedNode, () => clonedNode);\n}\n\nasync function embedChildren(clonedNode, options) {\n  const children = toArray(clonedNode.childNodes); // eslint-disable-next-line no-use-before-define\n\n  const deferreds = children.map(child => embedImages(child, options));\n  return Promise.all(deferreds).then(() => clonedNode);\n}\n\nexport async function embedImages(clonedNode, options) {\n  if (!(clonedNode instanceof Element)) {\n    return Promise.resolve(clonedNode);\n  }\n\n  return Promise.resolve(clonedNode).then(node => embedBackground(node, options)).then(node => embedImageNode(node, options)).then(node => embedChildren(node, options));\n}","map":{"version":3,"mappings":"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","names":["getBlobFromURL","embedResources","getMimeType","isDataUrl","makeDataUrl","toArray","embedBackground","clonedNode","options","background","style","_a","getPropertyValue","Promise","resolve","then","cssString","setProperty","getPropertyPriority","embedImageNode","HTMLImageElement","src","SVGImageElement","href","baseVal","url","data","blob","contentType","dataURL","reject","onload","onerror","srcset","embedChildren","children","childNodes","deferreds","map","child","embedImages","all","Element","node"],"sourceRoot":"","sources":["../src/embedImages.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module"}